{-# OPTIONS --prop --rewriting --allow-unsolved-metas #-}

open import Diags
open import Arity
open import Sliding
open import Identities
open import BraidingNaturality

∩/⁻¹ : ∩ · /⁻¹ ~ ∩
∩/⁻¹ = ~·· (~·· (·⊗∩ ■ ~⊗ ·∣∣ ■ - ·⊗∣∣))
       ■ -·· ■ ··~ (·~ ⊗∣·⊗∣ ■ ⊗∣·⊗∣ ■ ~⊗ (·· ■ ∩∣∣/∪∣)) ■ ·∣∣

/⁻¹∪ : /⁻¹ · ∪ ~ ∪
/⁻¹∪ = -·· ■ ·~ (⊗∣∣· ■ - ∣∣⊗·) ■ ~·· (~· (~· -⊗⊗ ■ ·~ -⊗⊗ ■ ∣⊗·∣⊗) ■ ·~ -⊗⊗ ■ ∣⊗·∣⊗)
       ■ ~· (⊗~ ∣∩/∣∣∪) ■ ∣∣·


∣∩∣/⁻¹/∣∪∣ :   ∣ ⊗   ∩   ⊗ ∣
             ·  /⁻¹  ⊗   /
             · ∣ ⊗   ∪   ⊗ ∣ ~ ∪ ⊗ ∩
∣∩∣/⁻¹/∣∪∣ = ~· (·~ (⊗~ (- ·∣∣ ■ - ·∣∣) ■ (·⊗· ■ ~· ·⊗·))) ■ -··
             ■ ·~ (··~ (~· (- ⊗⊗⊗) ■ ∪⊗· ■ ⊗~ (~· ⊗⊗⊗ ■ ∣∣∣∣·)))
             ■ ·~ (··~ (~· (-⊗⊗ ■ ⊗~ ⊗⊗) ■ ·~ (⊗⊗ ■ ~⊗ ⊗⊗ ■  -⊗⊗)
                                   ■ - ·⊗· ■ ⊗~ (∣∣∣· ■ - ·∣) ■ ·⊗·))
             ■ ·~ (~·· (~· (- ∣∣⊗·⊗∣∣) ■ ··~ (·~ ⊗⊗ ■ ⊗∩∣⊗·⊗∪⊗)))
             ■ ·~ (~· (·~ ∣∣∣∣·)) ■ ··
             ■ ~· (~·· (·~ -⊗⊗ ■ ~· -⊗⊗ ■ ∣⊗·∣⊗) ■ ·~ -⊗⊗ ■ ∣⊗·∣⊗ ■ ⊗~ ∩∣∣//∣)
             ■ ~· ⊗⊗ ■ ∣∣⊗·⊗∣∣

∣∩/⁻¹∣ : ∣ ⊗ ∩ · /⁻¹ ⊗ ∣ ~ ∩ ⊗ ∣ · ∣ ⊗ /
∣∩/⁻¹∣ = - ·∣∣∣
         ■ ·~ (~⊗ (⊗~ (- ∪∩)) ■ ~⊗ (- ∣⊗·∣⊗) ■ - ⊗∣·⊗∣ ■ ~· (-⊗⊗ ■ ⊗~ (-⊗⊗ ■ ⊗~ (- ∣∩/∣∣/))))
         ■ ·~ (~· (⊗~ (- ∣⊗·∣⊗ ■ ~· (- ∣⊗·∣⊗)) ■ - ∣⊗·∣⊗ ■ ~· (- ∣⊗·∣⊗)))
         ■ ·~ (··~ (~· (⊗⊗ ■ ⊗⊗) ■ ·~ (~⊗ ⊗⊗) ■ ∣∣∣⊗·⊗∣∣) ■ ·~ (- ⊗∣∣·∣⊗)) ■ ··
         ■ ~·· (~· (~·· (··~ (·~ ⊗⊗⊗ ■ ·⊗∩ ■ ~⊗ ·∣∣∣)))
                ■ ~· (~· (·⊗∩ ■ - ∣⊗·⊗∣∣ ■ ·~ (- ⊗∣∣·⊗∣∣)) ■ ··~ (··~ (·~ ⊗⊗⊗ ■ ·~ -⊗⊗ ■ ⊗∣∣∣·∣∣⊗)))
                ■ ··~ (~· (·~ ⊗⊗) ■ ~· ⊗∣·⊗∣ ■ ⊗∣·⊗∣ ■ ~⊗ ∣∩∣/⁻¹/∣∪∣ ■ -⊗⊗ ■ - ⊗∣·⊗)
                ■ ~·· ∪∩ ■ ∣·)

//⁻¹ : / · /⁻¹ ~ ∣ ⊗ ∣
//⁻¹ = ··
       ■ ~· (~·· (·⊗∩ ■ ~⊗ ·∣∣ ■ - ∣∣⊗·⊗∣∣)) ■ -··
       ■ ··~ (·~ ⊗∣·⊗∣ ■ ⊗∣·⊗∣ ■ ~⊗ (·· ■ /∣∣/∪∣) ■ -⊗⊗)
       ■ ~· -⊗⊗ ■ ∣⊗·∣⊗ ■ ⊗~ ∪∩

/⁻¹/ : /⁻¹ · / ~ ∣ ⊗ ∣
/⁻¹/ = -·· ■ ·~ (⊗∣∣· ■ - ∣∣⊗·⊗∣∣) ■ ··
       ■ ~· (~· (~· -⊗⊗ ■ ·~ -⊗⊗) ■ ·~ -⊗⊗ ■ - ··⊗·· ■ ⊗~ ∣∩/∣∣/ ■ ~⊗ (·∣ ■ ·∣) ■ ⊗⊗)
       ■ ⊗∣·⊗∣ ■ ~⊗ ∪∩

∩∣∣/⁻¹ : ∩ ⊗ ∣ · ∣ ⊗ /⁻¹ ~ ∣ ⊗ ∩ · / ⊗ ∣
∩∣∣/⁻¹ = ~· (- ∣∩/∣∣/) ■ - ··· ■ ·~ (·~ (∣⊗·∣⊗ ■ ⊗~ //⁻¹ ■ ⊗⊗) ■ ·∣∣∣)

/⁻¹∣∣∪ : /⁻¹ ⊗ ∣ · ∣ ⊗ ∪ ~ ∣ ⊗ / · ∪ ⊗ ∣
/⁻¹∣∣∪ = ·~ (- /∣∣/∪∣) ■ ~·· (~·· (⊗∣·⊗∣ ■ ~⊗ /⁻¹/) ■ ∣∣∣·)

∣∩∣//⁻¹∣∪∣ : ∣ ⊗ ∩ ⊗ ∣ · / ⊗ /⁻¹ · ∣ ⊗ ∪ ⊗ ∣ ~ ∪ ⊗ ∩
∣∩∣//⁻¹∣∪∣ = ~· (·~ (- ∣∣⊗·⊗∣∣) ■ ~·· (~· -⊗⊗ ■ ·~ -⊗⊗ ■ - ·⊗· ■ ⊗~ ∩∣∣/⁻¹ ■ ·⊗· ■ ·~ ⊗⊗ ■ ~· ⊗⊗))
             ■ - ··· ■ ·~ (~·· ⊗∣·⊗∣ ■ ⊗∣·⊗∣ ■ ~⊗ ∣//∣∣∪) ■ ∣∣⊗·⊗∣∣

-- another Reidemeister Type II relation
∣∩/⁻¹∣∣/⁻¹ : ∣ ⊗ ∩ · /⁻¹ ⊗ ∣ · ∣ ⊗ /⁻¹ ~ ∩ ⊗ ∣
∣∩/⁻¹∣∣/⁻¹ = ~· (~· (- ∩∣∣//∣) ■ ··~ (⊗∣·⊗∣ ■ ~⊗ //⁻¹) ■ ·∣∣∣)
             ■ ··~ (∣⊗·∣⊗ ■ ⊗~ //⁻¹ ■ ⊗⊗) ■ ·∣∣∣

/n1⁻¹ : ∀{n} → /mn⁻¹ n 1 ~ /n⁻¹
/n1⁻¹ = ∣n· ■ ⊗ε

/1n⁻¹ : ∀{n} → /mn⁻¹ 1 n ~ /-n⁻¹
/1n⁻¹ {zero}  = ⊗ε
/1n⁻¹ {suc n} = ~· (⊗~ /1n⁻¹) ■ ·~ (~⊗ (∣∣· ■ ε⊗))

/n·/n⁻¹ : ∀{n} → /n · /n⁻¹ ~ ∣ ^⊗ (suc n)
/n·/n⁻¹ {zero}  = ·∣ ■ - ⊗ε
/n·/n⁻¹ {suc n} = ~·· (··~ (⊗∣·⊗∣ ■ ~⊗ /n·/n⁻¹ ■ - ∣^⊗suc) ■ ·∣n) ■ ∣n⊗·∣n⊗
                  ■ ⊗~ //⁻¹ ■ ⊗⊗ ■ ~⊗ (- ∣^⊗suc) ■ - ∣^⊗suc

/n⁻¹·/n : ∀{n} → /n⁻¹ · /n ~ ∣ ^⊗ (suc n)
/n⁻¹·/n {zero}  = ·∣ ■ - ⊗ε
/n⁻¹·/n {suc n} = ~·· (··~ (∣n⊗·∣n⊗ ■ ⊗~ /⁻¹/ ■ ⊗⊗ ■ ~⊗ (- ∣^⊗suc) ■ - ∣^⊗suc) ■ ·∣n)
                  ■ ⊗∣·⊗∣ ■ ~⊗ /n⁻¹·/n ■ - ∣^⊗suc

/mn·/mn⁻¹ : ∀{m}{n} → /mn m n · /mn⁻¹ m n ~ ∣ ^⊗ _
/mn·/mn⁻¹ {m}{zero}  = ·∣n
/mn·/mn⁻¹ {m}{suc n} = ~·· (··~ (∣⊗·∣⊗ ■ ⊗~ (/mn·/mn⁻¹ {m} {n})) ■ ·∣n)
                       ■ ⊗∣n·⊗∣n ■ ~⊗ /n·/n⁻¹ ■ -⊗⊗ ■ ⊗~ (- ∣^⊗+)

/mn⁻¹·/mn : ∀{m}{n} → /mn⁻¹ m n · /mn m n ~ ∣ ^⊗ _
/mn⁻¹·/mn {m} {zero}  = ·∣n
/mn⁻¹·/mn {m} {suc n} = ~·· (··~ (⊗∣n·⊗∣n ■ ~⊗ /n⁻¹·/n ■ -⊗⊗ ■ ⊗~ (- ∣^⊗+)) ■ ·∣n)
                        ■ ∣⊗·∣⊗ ■ ⊗~ (/mn⁻¹·/mn {m} {n})

X·X⁻¹ : ∀{n} → X {n} · X⁻¹ ~ ∣ ^⊗ n
X·X⁻¹ {zero}  = ·ε
X·X⁻¹ {suc n} = ~·· (··~ (∣⊗·∣⊗ ■ ⊗~ X·X⁻¹) ■ ·∣n) ■ /n·/n⁻¹

X⁻¹·X : ∀{n} → X⁻¹ {n} · X ~ ∣ ^⊗ n
X⁻¹·X {zero}  = ·ε
X⁻¹·X {suc n} = ~·· (··~ /n⁻¹·/n ■ ·∣n) ■ ∣⊗·∣⊗ ■ ⊗~ X⁻¹·X

-- naturality of /mn⁻¹
/mn⁻¹·⊗ : ∀{m n k l}{d : D m n}{e : D k l} → /mn⁻¹ k m · e ⊗ d ~ d ⊗ e · /mn⁻¹ l n
/mn⁻¹·⊗ {m}{n}{k}{l}{d}{e} = - ·∣n ■ ·~ (- (/mn·/mn⁻¹ {l} {n}))
   ■ ··~ (~·· (- /mn·⊗)) ■ ~·· (~·· (/mn⁻¹·/mn {k} {m})) ■ ~· ∣n·

-- naturality of /n⁻¹
/n⁻¹·⊗∣ : ∀{m n}{d : D m n} → /n⁻¹ · d ⊗ ∣ ~ ∣ ⊗ d · /n⁻¹
/n⁻¹·⊗∣ = ~· (- /n1⁻¹) ■ /mn⁻¹·⊗ ■ ·~ /n1⁻¹

-- naturality of /-n⁻¹
/-n⁻¹·⊗∣ : ∀{m n}{d : D m n} → /-n⁻¹ · ∣ ⊗ d ~ d ⊗ ∣ · /-n⁻¹
/-n⁻¹·⊗∣ = ~· (- /1n⁻¹) ■ /mn⁻¹·⊗ ■ ·~ /1n⁻¹

-- /⁻¹ moves through board
/⁻¹[B] : ∀{l r} → ∣n⊗∣m l /⁻¹ r · B [ l + r + 2 ] ~ B [ l + r + 2 ] · ∣n⊗∣m l /⁻¹ r
/⁻¹[B] {l}{r} = ~· (~⊗ (- ∣n⊗·∣n⊗ ■ ~· (- ∣n⊗·∣n⊗)) ■ - ⊗∣n·⊗∣n ■ ~· (- ⊗∣n·⊗∣n))
         ■ ··~ (~· (-⊗⊗ ■ ⊗~ (-⊗⊗ ■ -⊗⊗) ■ ⊗⊗) ■ ∪[B] {l} {r + 2})
         ■ ~·· (··~ (~· (~⊗ (⊗⊗ ■ ~⊗ (⊗⊗ ■ ~⊗ (- ∣^⊗suc))) ■ -⊗⊗) ■ /[B] {l + 1} {r + 1}))
         ■ ~· (~·· (~· (~⊗ (⊗⊗ ■ ~⊗ (⊗⊗ ■ - (∣^⊗suc ■ ~⊗ ∣^⊗suc)))) ■ ∩[B] {l + 2} {r}))
         ■ -·· ■ ··~ (·~ (~· ⊗⊗ ■ ·~ ⊗⊗⊗ ■ ⊗∣n·⊗∣n) ■ ⊗∣n·⊗∣n
           ■ ~⊗ (·~ (~· (~⊗ (~⊗ ∣^⊗suc) ■ - ⊗⊗⊗) ■ ·~ (- ⊗⊗⊗) ■ ∣n⊗·∣n⊗)
             ■ ~· (~⊗ (⊗~ ∣^⊗suc ■ ⊗⊗ ■ ~⊗ ∣^⊗suc ■ -⊗⊗) ■ -⊗⊗) ■ ∣n⊗·∣n⊗
             ■ ⊗~ (·· ■ ·~ ⊗⊗ ■ ~· (·~ ⊗⊗))))
