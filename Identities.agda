{-# OPTIONS --prop --rewriting --allow-unsolved-metas #-}

open import Diags
open import Arity
open import Sliding

··⊗·· : ∀{m n k l m' n' k' l'}{d : D m n}{e : D n k}{f : D k l}{d' : D m' n'}{e' : D n' k'}{f' : D k' l'}
        → (d · e · f) ⊗ (d' · e' · f') ~* d ⊗ d' · e ⊗ e' · f ⊗ f'
··⊗·· = ι ·⊗· ■ ~·* (ι ·⊗·)

·⊗∣ : ∀{m n k}{d : D m n}{e : D n k} → (d · e) ⊗ ∣ ~* d ⊗ ∣ · e ⊗ ∣
·⊗∣ = ⊗~* (- ∣·) ■ ι ·⊗·

⊗∣·⊗∣ : ∀{m n k}{d : D m n}{e : D n k} → d ⊗ ∣ · e ⊗ ∣ ~* (d · e) ⊗ ∣
⊗∣·⊗∣ = - (ι ·⊗·) ■ ⊗~* ∣·

∣⊗·∣⊗ : ∀{m n k}{d : D m n}{e : D n k} → ∣ ⊗ d · ∣ ⊗ e ~* ∣ ⊗ (d · e)
∣⊗·∣⊗ = - (ι ·⊗·) ■ ~⊗* ∣·

⊗∣∣·⊗∣∣ : ∀{m n k}{d : D m n}{e : D n k} → d ⊗ ∣ ⊗ ∣ · e ⊗ ∣ ⊗ ∣ ~* (d · e) ⊗ ∣ ⊗ ∣
⊗∣∣·⊗∣∣ = ~·* -⊗⊗ ■ ·~* -⊗⊗ ■ - (ι ·⊗·) ■ ⊗~* ∣∣· ■ ι ⊗⊗

∣∣⊗·∣∣⊗ : ∀{m n k}{d : D m n}{e : D n k} → ∣ ⊗ ∣ ⊗ d · ∣ ⊗ ∣ ⊗ e ~* ∣ ⊗ ∣ ⊗ (d · e)
∣∣⊗·∣∣⊗ = - (ι ·⊗·) ■ ~⊗* ∣∣·

∣n⊗·∣n⊗ : ∀{m n k l}{d : D m n}{e : D n k} → ∣ ^⊗ l ⊗ d · ∣ ^⊗ l ⊗ e ~* ∣ ^⊗ l ⊗ (d · e)
∣n⊗·∣n⊗ = - (ι ·⊗·) ■ ~⊗* (ι ∣n·)

∣^⊗suc : ∀{n} → ∣ ^⊗ (suc n) ~* ∣ ^⊗ n ⊗ ∣
∣^⊗suc {zero}  = ι ⊗ε ■ - (ι ε⊗)
∣^⊗suc {suc n} = ⊗~* ∣^⊗suc ■ ι ⊗⊗

∣^⊗+ : ∀{m n} → ∣ ^⊗ (m + n) ~* ∣ ^⊗ m ⊗ ∣ ^⊗ n
∣^⊗+ {zero}  = - (ι ε⊗)
∣^⊗+ {suc m} = ⊗~* ∣^⊗+ ■ ι ⊗⊗

⊗∩∣⊗·⊗∪⊗ : ∀{m n k m' n' k'}{d : D m n}{e : D (suc n) k}{d' : D m' n'}{e' : D n' k'}
           → d ⊗ ∩ ⊗ ∣ ⊗ d' · e ⊗ ∪ ⊗ e' ~* d ⊗ ∣ ⊗ d' · e ⊗ e'
⊗∩∣⊗·⊗∪⊗ = - (ι ·⊗·) ■ ~⊗* (·~* (~⊗* (- (ι ∣n·)) ■ - ⊗∪·))
           ■ ~⊗* (ι ·· ■ ~·* (~·* -⊗⊗ ■ (·~* (~⊗* ∣^⊗suc ■ -⊗⊗) ■ - (ι ·⊗·) ■ ~⊗* (ι ·∣n) ■ ⊗~* (ι ∩∪))))
           ■ ι ·⊗·

⊗∩⊗·⊗∪⊗ : ∀{m n k m' n' k'}{d : D m n}{e : D (suc n) k}{d' : D m' (suc n')}{e' : D n' k'}
           → d ⊗ ∩ ⊗ d' · e ⊗ ∪ ⊗ e' ~* d ⊗ d' · e ⊗ e'
⊗∩⊗·⊗∪⊗ = ~·* (- ∣n⊗·⊗∣m) ■ -·· ■ ·~* (~·* (ι ⊗⊗) ■ ⊗∩∣⊗·⊗∪⊗) ■ ι ·· ■ ~·* (·~* -⊗⊗ ■ ∣n⊗·⊗∣m)

/⁻¹ : D 2 2 
/⁻¹ =   ∣ ⊗ ∣ ⊗   ∩
      · ∣ ⊗   /   ⊗ ∣
      ·   ∪   ⊗ ∣ ⊗ ∣

/⁻¹∣∣/⁻¹ :    /⁻¹ ⊗ ∣
           · ∣ ⊗ /⁻¹  ~* ∣ ⊗ ∣ ⊗ ∣ ⊗   ∩
                       · ∣ ⊗ ∣ ⊗   /   ⊗ ∣
                       · ∣ ⊗   /   ⊗ ∣ ⊗ ∣
                       ·   ∪   ⊗ ∣ ⊗ ∣ ⊗ ∣
/⁻¹∣∣/⁻¹ = ~·* (⊗~* (- (·∣ ■ ·∣)) ■ ··⊗··)
           ■ ·~* (~⊗* (- (·∣ ■ ·∣)) ■ ··⊗·· ■ -·· ■ ~·* (ι ⊗⊗ ■ ~⊗* (ι ⊗⊗)))
           ■ ι ·· ■ ·∪∣∣∣·∣∣∣∩·  ■ ·~* (- ∪⊗·) ■ ~·* (⊗~* (- ·∣∣) ■ ι ·⊗·) ■ -··
           ■ ·~* (ι ·· ■ ~·* (·~* (ι ⊗⊗) ■ ~·* (-⊗⊗ ■ -⊗⊗) ■ - (ι ·⊗·) ■ ⊗~* (~·* ⊗⊗⊗ ■ ∣∣∣∣·)))
           ■ ~·* (-⊗⊗ ■ ~⊗* (- ∣∣·) ■ ⊗~* (- ·∣∣∣) ■ ι ·⊗· ■ ~·* (ι ⊗⊗))
           ■ -··
           ■ ·~* (·~* (~·* (ι ⊗⊗ ■ ~⊗* ((ι ⊗⊗) ■ ~⊗* ·⊗∣) ■ -⊗⊗))
                  ■ ~·* ((ι ⊗⊗) ■ -⊗⊗) ■ ι ·· ■ ~·* (- (ι ·⊗·) ■ ⊗~* ∣∣∣· ■ - ∣∣⊗·⊗∣∣∣ ■ ~·* (ι ⊗⊗))
                  ■ -··
                  ■ ·~* (·~* (ι ⊗⊗ ■ ~⊗* (ι ⊗⊗)) ■ ⊗∣∣·⊗∣∣
                         ■ ~⊗* (~⊗* (~·* (- ⊗∣·⊗∣ ■ ·~* (- ⊗∣·⊗∣)) ■ -··
                                     ■ ·~* (~·* (~·* -⊗⊗ ■ ·~* -⊗⊗) ■ - ··⊗·· ■ ⊗~* (-·· ■ ∣∣· ■ ∣∣·))
                                     ■ ·~* (- ∣∣∣⊗·) ■ ι ··
                                     ■ ~·* (~·* -⊗⊗ ■ ·~* -⊗⊗ ■ ∣∣⊗·∣∣⊗ ■ ⊗~* (ι ∩∪)) ■ ∣∣∣· ■ ·∣))
                         ■ - ⊗∣∣·⊗∣∣))
           ■ ι ·· ■ ι ··

∩∣∣/∪∣ : ∩ ⊗ ∣ · ∣ ⊗ / · ∪ ⊗ ∣ ~* ∣
∩∣∣/∪∣ = ·~* (~⊗* (- (ι /∪)) ■ - ⊗∣·⊗∣) ■ ι ·· ■ ~·* (ι ∩∣∣//∣) ■ ι ∪∩

∣∩/∣∣∪ : ∣ ⊗ ∩ · / ⊗ ∣ · ∣ ⊗ ∪ ~* ∣
∣∩/∣∣∪ = ~·* (~·* (⊗~* (- (ι ∩/)) ■ - ∣⊗·∣⊗)) ■ -·· ■ -·· ■ ·~* (ι ·· ■ ι ∣//∣∣∪) ■ ι ∪∩


