{-# OPTIONS --prop --rewriting --allow-unsolved-metas #-}

open import Diags


ε⊗ : ∀{m n}{c : C m n} → ε ⊗ c ~ ∣n · c
ε⊗ {c = l >A a < r} = rfl

>•< : ∀{m n k l r}{d : D m n}{e : D n k} → l > (d • e) < r ~ (l > d < r) • (l > e < r)
>•< {e = ∣n}               = rfl
>•< {e = e · (l >A a < r)} = ~· (>•< {e = e})

><+ : ∀{m n l r l' r'}{d : D m n} → l' > (l > d < r) < r' ~ (l' + l) > d < (r + r')
><+ {d = ∣n}             = rfl
><+ {d = d · l >A a < r} = ~· ><+

•• : ∀{m n k l}{d₁ : D m n}{d₂ : D n k}{d₃ : D k l} → d₁ • (d₂ • d₃) ~ d₁ • d₂ • d₃
•• {d₃ = ∣n}     = rfl
•• {d₃ = d₃ · c} = ~· (•• {d₃ = d₃})
{-
~• : ∀{m n k}{d d' : D m n}{e : D n k} → d ~ d' → d • e ~ d' • e
~• rfl = rfl
~• (- p) = - (~• p)
~• (p ■ p₁) = {!!}
~• (~· p) = {!!}
~• ↓↑ = {!!}
~• ∩∪ = {!!}
~• ∩/ = {!!}
~• ∣//∣∣∪ = {!!}
~• /∣∣/∪∣ = {!!}
~• ∩∣∣//∣ = {!!}
~• ∣∩/∣∣/ = {!!}
~• /// = {!!}
~• ∩·R = {!!}
~• ∪·R = {!!}
~• /·R = {!!}
~• /nR = {!!}

•~ : ∀{m n k}{d : D m n}{e e' : D n k} → e ~ e' → d • e ~ d • e'
•~ rfl     = rfl
•~ (- p)   = - (•~ p)
•~ (p ■ q) = •~ p ■ •~ q
•~ (~· p)  = ~· (•~ p)
•~ ↓↑      = ↓↑
•~ ∩∪      = ∩∪
•~ ∩/      = ∩/
•~ ∣//∣∣∪  = ∣//∣∣∪
•~ /∣∣/∪∣  = /∣∣/∪∣
•~ ∩∣∣//∣  = ∩∣∣//∣
•~ ∣∩/∣∣/  = ∣∩/∣∣/
•~ ///     = ///
•~ ∩·R     = ∩·R
•~ ∪·R     = ∪·R
•~ /·R     = /·R
•~ {d = d} (/nR {f = f})     = ~· (•• {d₁ = d}{f}) ■ /nR {f = d • f} ■ {!!}

><~ : ∀{m n l r}{d d' : D m n} → d ~ d' → l > d < r ~ l > d' < r
><~ rfl                     = rfl
><~ (- p)                   = - (><~ p)
><~ (p ■ q)                 = ><~ p ■ ><~ q
><~ (~· {c = l >A a < r} p) = ~· (><~ p)
><~ ↓↑                      = ↓↑
><~ ∩∪                      = ∩∪
><~ ∩/                      = ∩/
><~ ∣//∣∣∪                  = ∣//∣∣∪
><~ /∣∣/∪∣                  = /∣∣/∪∣
><~ ∩∣∣//∣                  = ∩∣∣//∣
><~ ∣∩/∣∣/                  = ∣∩/∣∣/
><~ ///                     = ///
><~ {l = l}{r} (∩·R {l = l₁}{l'}{r₁}{r'}{f = f}) = ∩·R {l₁}{l + l'}{r₁}{r' + r}{f = l > f < r}
><~ {l = l}{r} (∪·R {l = l₁}{l'}{r₁}{r'}{f = f}) = ∪·R {l₁}{l + l'}{r₁}{r' + r}{f = l > f < r}
><~ {l = l}{r} (/·R {l = l₁}{l'}{r₁}{r'}{f = f}) = /·R {l₁}{l + l'}{r₁}{r' + r}{f = l > f < r}
><~ {l = l}{r} (/nR {l₁}{r₁}{o}{n}{f = f})       = {!!} ■ /nR {l + l₁}{r₁ + r}{l + o + r}{n}{l > f < r} ■ {!!}
-}
><0 : ∀{m n}{d : D m n} → 0 > d < 0 ~ d
><0 {d = ∣n}             = rfl
><0 {d = d · l >A a < r} = ~· ><0

↑↓ : ∀{m n m' n' l r i o}{f : D o (l + m + i + m' + r)}{d : A m n}{e : A m' n'}
         → f · (l + m + i) >A e < r · l >A d < (i + n' + r) ~ f · l >A d < (i + m' + r) · (l + n + i) >A e < r
↑↓ {m}{n}{m'}{n'}{l}{r}{i} = - (↓↑ {m}{n}{m'}{n'}{l}{r}{i})

/∪ : ∀{l r o}{f : D o (l + 2 + r)} → f · (l >A / < r) · (l >A ∪ < r) ~ f · (l >A ∪ < r)
/∪ {l}{r} = ~· (~· (- (∩∪ {l + 1}{r})) ■ ↑↓) ■ ↑↓
            ■ ~· (- ∣//∣∣∪ ■ ~· (~· ∣∩/∣∣/ ■ ∩/) ■ ∩∪)

∪∩ : ∀{l r o}{f : D o (l + 1 + r)} → f · ((l + 1) >A ∩ < r) · (l >A ∪ < (r + 1)) ~ f
∪∩ = ~· (- ∩∣∣//∣) ■ /∪ ■ ~· (~· (- ∩/)) ■ /∣∣/∪∣ ■ ∩∪

/⁻¹/ : ∀{l r o}{f : D o (l + 2 + r)} → f • (l > /⁻¹ < r) · (l >A / < r) ~ f
/⁻¹/ = ↓↑ ■ ~· ∣∩/∣∣/ ■ ∪∩

∩∣∣/∪∣ : ∀{l r o}{f : D o (l + 1 + r)} → f · (l >A ∩ < (r + 1)) · ((l + 1) >A / < r) · (l >A ∪ < (r + 1)) ~ f
∩∣∣/∪∣ = - /∪ ■ ~· ∩∣∣//∣ ■ ∪∩

∣∩/∣∣∪ : ∀{l r o}{f : D o (l + 1 + r)} → f · ((l + 1) >A ∩ < r) · (l >A / < (r + 1)) · ((l + 1) >A ∪ < r) ~ f
∣∩/∣∣∪ = ~· (~· (- ∩/)) ■ ∣//∣∣∪ ■ ∪∩

//⁻¹ : ∀{l r o}{f : D o (l + 2 + r)} → (f · (l >A / < r)) • (l > /⁻¹ < r) ~ f
//⁻¹ = ~· (~· ↓↑) ■ /∣∣/∪∣ ■ ∪∩

{-

open import Arity
open import Sliding

~·· : ∀{m n k l}{d : D m n}{e : D n k}{f : D k l}{d' : D m k} → d · e ~ d'
      → d · (e · f) ~ d' · f
~·· p = ·· ■ ~· p

-~·· : ∀{m n k l}{d : D m n}{e : D n k}{f : D k l}{d' : D m k} → d · e ~ d'
      → d' · f ~ d · (e · f)
-~·· p = - (~·· p)

··~ : ∀{m n k l}{d : D m n}{e : D n k}{f : D k l}{e' : D n l} → e · f ~ e'
      → (d · e) · f ~ d · e'
··~ p = -·· ■ ·~ p

··⊗·· : ∀{m n k l m' n' k' l'}{d : D m n}{e : D n k}{f : D k l}{d' : D m' n'}{e' : D n' k'}{f' : D k' l'}
        → (d · e · f) ⊗ (d' · e' · f') ~ d ⊗ d' · e ⊗ e' · f ⊗ f'
··⊗·· = ·⊗· ■ ~· ·⊗·

·⊗∣ : ∀{m n k}{d : D m n}{e : D n k} → (d · e) ⊗ ∣ ~ d ⊗ ∣ · e ⊗ ∣
·⊗∣ = ⊗~ (- ∣·) ■ ·⊗·

⊗∣·⊗∣ : ∀{m n k}{d : D m n}{e : D n k} → d ⊗ ∣ · e ⊗ ∣ ~ (d · e) ⊗ ∣
⊗∣·⊗∣ = - ·⊗· ■ ⊗~ ∣·

∣⊗·∣⊗ : ∀{m n k}{d : D m n}{e : D n k} → ∣ ⊗ d · ∣ ⊗ e ~ ∣ ⊗ (d · e)
∣⊗·∣⊗ = - ·⊗· ■ ~⊗ ∣·

⊗∣∣·⊗∣∣ : ∀{m n k}{d : D m n}{e : D n k} → d ⊗ ∣ ⊗ ∣ · e ⊗ ∣ ⊗ ∣ ~ (d · e) ⊗ ∣ ⊗ ∣
⊗∣∣·⊗∣∣ = ~· -⊗⊗ ■ ·~ -⊗⊗ ■ - ·⊗· ■ ⊗~ ∣∣· ■ ⊗⊗

∣∣⊗·∣∣⊗ : ∀{m n k}{d : D m n}{e : D n k} → ∣ ⊗ ∣ ⊗ d · ∣ ⊗ ∣ ⊗ e ~ ∣ ⊗ ∣ ⊗ (d · e)
∣∣⊗·∣∣⊗ = - ·⊗· ■ ~⊗ ∣∣·

∣∣∣⊗·∣∣∣⊗ : ∀{m n k}{d : D m n}{e : D n k} → ∣ ⊗ ∣ ⊗ ∣ ⊗ d · ∣ ⊗ ∣ ⊗ ∣ ⊗ e ~ ∣ ⊗ ∣ ⊗ ∣ ⊗ (d · e)
∣∣∣⊗·∣∣∣⊗ = - ·⊗· ■ ~⊗ ∣∣∣·

∣n⊗·∣n⊗ : ∀{m n k l}{d : D m n}{e : D n k} → ∣ ^⊗ l ⊗ d · ∣ ^⊗ l ⊗ e ~ ∣ ^⊗ l ⊗ (d · e)
∣n⊗·∣n⊗ = - ·⊗· ■ ~⊗ ∣n·

⊗∣n·⊗∣n : ∀{m n k l}{d : D m n}{e : D n k} → d ⊗ ∣ ^⊗ l · e ⊗ ∣ ^⊗ l ~ (d · e) ⊗ ∣ ^⊗ l
⊗∣n·⊗∣n = - ·⊗· ■ ⊗~ ∣n·

∣^⊗suc : ∀{n} → ∣ ^⊗ (suc n) ~ ∣ ^⊗ n ⊗ ∣
∣^⊗suc {zero}  = ⊗ε ■ - ε⊗
∣^⊗suc {suc n} = ⊗~ ∣^⊗suc ■ ⊗⊗

∣^⊗+ : ∀{m n} → ∣ ^⊗ (m + n) ~ ∣ ^⊗ m ⊗ ∣ ^⊗ n
∣^⊗+ {zero}  = - ε⊗
∣^⊗+ {suc m} = ⊗~ ∣^⊗+ ■ ⊗⊗

⊗∩∣⊗·⊗∪⊗ : ∀{m n k m' n' k'}{d : D m n}{e : D (suc n) k}{d' : D m' n'}{e' : D n' k'}
           → d ⊗ ∩ ⊗ ∣ ⊗ d' · e ⊗ ∪ ⊗ e' ~ d ⊗ ∣ ⊗ d' · e ⊗ e'
⊗∩∣⊗·⊗∪⊗ = - ·⊗· ■ ~⊗ (·~ (~⊗ (- ∣n·) ■ - ⊗∪·))
           ■ ~⊗ (~·· (~· -⊗⊗ ■ (·~ (~⊗ ∣^⊗suc ■ -⊗⊗) ■ - ·⊗· ■ ~⊗ ·∣n ■ ⊗~ ∩∪)))
           ■ ·⊗·

⊗∩⊗·⊗∪⊗ : ∀{m n k m' n' k'}{d : D m n}{e : D (suc n) k}{d' : D m' (suc n')}{e' : D n' k'}
           → d ⊗ ∩ ⊗ d' · e ⊗ ∪ ⊗ e' ~ d ⊗ d' · e ⊗ e'
⊗∩⊗·⊗∪⊗ = ~· (- ∣n⊗·⊗∣m) ■ -·· ■ ·~ (~· ⊗⊗ ■ ⊗∩∣⊗·⊗∪⊗) ■ ~·· (·~ -⊗⊗ ■ ∣n⊗·⊗∣m)

/⁻¹∣∣/⁻¹ :    /⁻¹ ⊗ ∣
           · ∣ ⊗ /⁻¹  ~ ∣ ⊗ ∣ ⊗ ∣ ⊗   ∩
                      · ∣ ⊗ ∣ ⊗   /   ⊗ ∣
                      · ∣ ⊗   /   ⊗ ∣ ⊗ ∣
                      ·   ∪   ⊗ ∣ ⊗ ∣ ⊗ ∣
/⁻¹∣∣/⁻¹ = ~· (⊗~ (- (·∣ ■ ·∣)) ■ ··⊗··)
           ■ ·~ (~⊗ (- (·∣ ■ ·∣)) ■ ··⊗·· ■ - ·· ■ ~· (⊗⊗ ■ ~⊗ ⊗⊗))
           ■ ·· ■ ·∪∣∣∣·∣∣∣∩·  ■ ·~ (- ∪⊗·) ■ ~· (⊗~ (- ·∣∣) ■ ·⊗·) ■ -··
           ■ ·~ (~·· (·~ ⊗⊗ ■ ~· (-⊗⊗ ■ -⊗⊗) ■ - ·⊗· ■ ⊗~ (~· ⊗⊗⊗ ■ ∣∣∣∣·)))
           ■ ~· (-⊗⊗ ■ ~⊗ (- ∣∣·) ■ ⊗~ (- ·∣∣∣) ■ ·⊗· ■ ~· ⊗⊗)
           ■ ··~ (·~ (~· (⊗⊗ ■ ~⊗ (⊗⊗ ■ ~⊗ ·⊗∣) ■ -⊗⊗))
             ■ ~· (⊗⊗ ■ -⊗⊗) ■ ~·· (- ·⊗· ■ ⊗~ ∣∣∣· ■ - ∣∣⊗·⊗∣∣∣ ■ ~· ⊗⊗)
             ■ ··~ (·~ (⊗⊗ ■ ~⊗ ⊗⊗) ■ ⊗∣∣·⊗∣∣
               ■ ~⊗ (~⊗ (~· (- ⊗∣·⊗∣ ■ ·~ (- ⊗∣·⊗∣))
                 ■ ··~ (~· (~· -⊗⊗ ■ ·~ -⊗⊗) ■ - ··⊗·· ■ ⊗~ (-·· ■ ∣∣· ■ ∣∣·))
                 ■ ·~ (- ∣∣∣⊗·) ■ ~·· (~· -⊗⊗ ■ ·~ -⊗⊗ ■ ∣∣⊗·∣∣⊗ ■ ⊗~ ∩∪) ■ ∣∣∣· ■ ·∣))
                         ■ - ⊗∣∣·⊗∣∣))
           ■ ·· ■ ··

∩⊗·∣/⊗·∪⊗ : ∀{m n k l}{d : D m (suc n)}{e : D n k}{f : D (suc k) l}
            → ∩ ⊗ d · ∣ ⊗ / ⊗ e · ∪ ⊗ f ~ d · ∣ ⊗ e · f
∩⊗·∣/⊗·∪⊗ = ~· (~· (- ·∣n ■ ·~ ⊗⊗ ■ - ·⊗· ■ ~⊗ ·∣∣ ■ - ·∩⊗ ■ ·~ ⊗⊗))
            ■ ·~ (- ∣n· ■ ~· ⊗⊗ ■ - ·⊗· ■ ~⊗ ∣∣· ■ - ∪⊗· ■ ~· ⊗⊗)
            ■ ~·· (-·· ■ ··~ (·· ■ - ··⊗·· ■ ~⊗ ∩∣∣/∪∣ ■ ⊗~ (·∣n ■ ∣n·)))

⊗∩·⊗/∣·⊗∪ : ∀{m n k l}{d : D m (suc n)}{e : D n k}{f : D (suc k) l}
            → d ⊗ ∩ · e ⊗ / ⊗ ∣ · f ⊗ ∪ ~ d · e ⊗ ∣ · f
⊗∩·⊗/∣·⊗∪ = ~· (~· (- ·∣n ■ ·~ (∣^⊗suc ■ ~⊗ ∣^⊗suc ■ -⊗⊗) ■ - ·⊗· ■ ⊗~ ·∣∣ ■ - ·⊗∩ ■ ·~ -⊗⊗))
            ■ ·~ (- ∣n· ■ ~· (∣^⊗suc ■ ~⊗ ∣^⊗suc ■ -⊗⊗) ■ - ·⊗· ■ ⊗~ ∣∣· ■ - ⊗∪· ■ ~· -⊗⊗)
            ■ ~·· (-·· ■ -·· ■ ·~ (~·· (~· (⊗⊗ ■ ~⊗ ∣^⊗suc ■ -⊗⊗) ■ ·~ -⊗⊗)
               ■ ·~ (⊗⊗ ■ ~⊗ ∣^⊗suc ■ -⊗⊗) ■ - ··⊗·· ■ ~⊗ (·∣n ■ ∣n·) ■ ⊗~ ∣∩/∣∣∪))

M⁻¹ : D 1 0
M⁻¹ = ∣ ⊗ M · ∪
-}
